@{ 
    var controller = ViewContext?.RouteData?.Values["controller"]?.ToString();
    var action = ViewContext?.RouteData?.Values["action"]?.ToString();
}
<!DOCTYPE html>
<html lang="zh-tw">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">



    <!-- Favicon icon-->
    <link rel="shortcut icon" type="image/x-icon" href="@Url.Content("~/assets/images/favicon/favicon.ico")">

    <!-- Libs CSS -->


    <link href="@Url.Content("~/assets/libs/bootstrap-icons/font/bootstrap-icons.css")" rel="stylesheet">
    <link href="@Url.Content("~/assets/libs/dropzone/dist/dropzone.css")" rel="stylesheet">
    <link href="@Url.Content("~/assets/libs/@mdi/font/css/materialdesignicons.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/assets/libs/prismjs/themes/prism-okaidia.min.css")" rel="stylesheet">








    <!-- Theme CSS -->
    <link rel="stylesheet" href="@Url.Content("~/assets/css/theme.min.css")">
    <link rel="stylesheet" href="@Url.Content("~/lib/fontawesome/css/all.css")">
    <link rel="stylesheet" href="@Url.Content("~/lib/Datatables/datatables.css")">
    <link rel="stylesheet" href="@Url.Content("~/lib/select2/css/select2.css")">
    <link rel="stylesheet" href="@Url.Content("~/lib/toastr.js/toastr.min.css")">

    <link rel="stylesheet" href="@Url.Content("~/lib/filepond/filepond.css")">
    <link rel="stylesheet" href="@Url.Content("~/lib/filepond/plugin/filepond-plugin-get-file/filepond-plugin-get-file.css")">
    <link rel="stylesheet" href="@Url.Content("~/lib/filepond/plugin/filepond-plugin-image-overlay/filepond-plugin-image-overlay.css")">
    <link rel="stylesheet" href="@Url.Content("~/lib/filepond/plugin/filepond-plugin-get-file/filepond-plugin-get-file.css")">
    <link rel="stylesheet" href="@Url.Content("~/lib/filepond/plugin/filepond-plugin-image-preview/filepond-plugin-image-preview.css")">
    <link rel="stylesheet" href="@Url.Content("~/lib/filepond/plugin/filepond-plugin-media-preview/filepond-plugin-media-preview.css")">
    <link rel="stylesheet" href="@Url.Content("~/lib/filepond/plugin/filepond-plugin-move-file/filepond-plugin-move-file.css")">
    <link rel="stylesheet" href="@Url.Content("~/lib/filepond/plugin/filepond-plugin-pdf-preview/filepond-plugin-pdf-preview.css")">

    <link rel="stylesheet" href="@Url.Content("~/lib/site/main.css")">
    @RenderSection("Styles", required: false)
    <title>@_configuration["SiteName"].ToString()</title>
</head>

<body class="bg-light">
    <div id="db-wrapper">
        <!-- navbar vertical -->
        <!-- Sidebar -->
        <vc:sidebar controller="@controller" action="@action"></vc:sidebar>
        <!-- Page content -->
        <div id="page-content">
            <div class="header @@classList">
                <!-- navbar -->
                <nav class="navbar-classic navbar navbar-expand-lg">
                    <a id="nav-toggle" href="#">
                        <i data-feather="menu"
                           class="nav-icon me-2 icon-xs"></i>
                    </a>
                    <div class="ms-lg-3 d-none d-md-none d-lg-block">
                        <!-- Form -->
                        <form class="d-flex align-items-center">
                            <input type="search" class="form-control" placeholder="Search" />
                        </form>
                    </div>
                    <!--Navbar nav -->
                    <ul class="navbar-nav navbar-right-wrap ms-auto d-flex nav-top-wrap">
                        <li class="dropdown stopevent">
                            <vc:language></vc:language>
                        </li>
                        <li class="dropdown stopevent">
                            <a class="btn btn-light btn-icon rounded-circle indicator
          indicator-primary text-muted" href="#" role="button"
                               id="dropdownNotification" data-bs-toggle="dropdown" aria-haspopup="true"
                               aria-expanded="false">
                                <i class="icon-xs" data-feather="bell"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end"
                                 aria-labelledby="dropdownNotification">
                                <div>
                                    <div class="border-bottom px-3 pt-2 pb-3 d-flex
              justify-content-between align-items-center">
                                        <p class="mb-0 text-dark fw-medium fs-4">Notifications</p>
                                        <a href="#" class="text-muted">
                                            <span>
                                                <i class="me-1 icon-xxs" data-feather="settings"></i>
                                            </span>
                                        </a>
                                    </div>
                                    <!-- List group -->
                                    <ul class="list-group list-group-flush notification-list-scroll">
                                        <!-- List group item -->
                                        <li class="list-group-item bg-light">


                                            <a href="#" class="text-muted">
                                                <h5 class=" mb-1">Rishi Chopra</h5>
                                                <p class="mb-0">
                                                    Mauris blandit erat id nunc blandit, ac eleifend dolor pretium.
                                                </p>
                                            </a>



                                        </li>
                                        <!-- List group item -->
                                        <li class="list-group-item">


                                            <a href="#" class="text-muted">
                                                <h5 class=" mb-1">Neha Kannned</h5>
                                                <p class="mb-0">
                                                    Proin at elit vel est condimentum elementum id in ante. Maecenas et sapien metus.
                                                </p>
                                            </a>



                                        </li>
                                        <!-- List group item -->
                                        <li class="list-group-item">


                                            <a href="#" class="text-muted">
                                                <h5 class=" mb-1">Nirmala Chauhan</h5>
                                                <p class="mb-0">
                                                    Morbi maximus urna lobortis elit sollicitudin sollicitudieget elit vel pretium.
                                                </p>
                                            </a>



                                        </li>
                                        <!-- List group item -->
                                        <li class="list-group-item">


                                            <a href="#" class="text-muted">
                                                <h5 class=" mb-1">Sina Ray</h5>
                                                <p class="mb-0">
                                                    Sed aliquam augue sit amet mauris volutpat hendrerit sed nunc eu diam.
                                                </p>
                                            </a>



                                        </li>
                                    </ul>
                                    <div class="border-top px-3 py-2 text-center">
                                        <a href="#" class="text-inherit fw-semi-bold">
                                            View all Notifications
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <!-- List -->
                        <li class="dropdown ms-2">
                            <vc:user-profile></vc:user-profile>
                        </li>
                    </ul>
                </nav>
            </div>
            <!-- Container fluid -->
            <div class="container-fluid">
                @RenderBody()
            </div>
        </div>
    </div>



    <!-- Scripts -->
    <!-- Libs JS -->
    <script src="@Url.Content("~/assets/libs/jquery/dist/jquery.min.js")"></script>
    <script src="@Url.Content("~/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js")"></script>
    <script src="@Url.Content("~/assets/libs/jquery-slimscroll/jquery.slimscroll.min.js")"></script>
    <script src="@Url.Content("~/assets/libs/feather-icons/dist/feather.min.js")"></script>
    <script src="@Url.Content("~/assets/libs/prismjs/prism.js")"></script>
    <script src="@Url.Content("~/assets/libs/apexcharts/dist/apexcharts.min.js")"></script>
    <script src="@Url.Content("~/assets/libs/dropzone/dist/min/dropzone.min.js")"></script>
    <script src="@Url.Content("~/assets/libs/prismjs/plugins/toolbar/prism-toolbar.min.js")"></script>
    <script src="@Url.Content("~/assets/libs/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js")"></script>



    <script src="@Url.Content("~/lib/jquery-validate/jquery.validate.js")"></script>
    <script src="@Url.Content("~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js")"></script>
    <!-- Theme JS -->
    <script src="@Url.Content("~/assets/js/theme.min.js")"></script>
    <script src="@Url.Content("~/lib/fontawesome/js/all.js")"></script>
    <script src="@Url.Content("~/lib/Datatables/datatables.js")"></script>
    <script src="@Url.Content("~/lib/select2/js/select2.js")"></script>
    <script src="@Url.Content("~/lib/select2/js/i18n/en-US.js")"></script>
    <script src="@Url.Content("~/lib/select2/js/i18n/zh-CN.js")"></script>
    <script src="@Url.Content("~/lib/select2/js/i18n/zh-TW.js")"></script>
    <script src="@Url.Content("~/lib/toastr.js/toastr.min.js")"></script>
    <script src="@Url.Content("~/lib/microsoft-signalr/signalr.min.js")"></script>

    <script src="@Url.Content("~/lib/filepond/filepond.js")"></script>
    <script src="@Url.Content("~/lib/filepond/plugin/filepond-plugin-file-metadata/filepond-plugin-file-metadata.js")"></script>
    <script src="@Url.Content("~/lib/filepond/plugin/filepond-plugin-file-validate-type/filepond-plugin-file-validate-type.js")"></script>
    <script src="@Url.Content("~/lib/filepond/plugin/filepond-plugin-get-file/filepond-plugin-get-file.js")"></script>
    <script src="@Url.Content("~/lib/filepond/plugin/filepond-plugin-image-overlay/filepond-plugin-image-overlay.js")"></script>
    <script src="@Url.Content("~/lib/filepond/plugin/filepond-plugin-image-preview/filepond-plugin-image-preview.js")"></script>
    <script src="@Url.Content("~/lib/filepond/plugin/filepond-plugin-media-preview/filepond-plugin-media-preview.js")"></script>
    <script src="@Url.Content("~/lib/filepond/plugin/filepond-plugin-move-file/filepond-plugin-move-file.js")"></script>
    <script src="@Url.Content("~/lib/filepond/plugin/filepond-plugin-pdf-preview/filepond-plugin-pdf-preview.js")"></script>

    <script src="@Url.Content("~/lib/site/main.js")"></script>
    @RenderSection("Scripts", required: false)

    <script>
        $(async () => {
            const connection = new signalR.HubConnectionBuilder().withUrl("/NotificationHub").build();

            async function start() {
                try {
                    await connection.start();
                    console.log("NotificationHub Connected.");
                } catch (err) {
                    console.log(err);
                    //發生錯誤5秒後重新連線
                    setTimeout(start, 5000);
                }
            };

            connection.onclose(async () => {
                //連線被中斷後,重新連線
                await start();
            });

            connection.on("ReceiveMessage", function (data) {
                toastr.options = {
                    "escapeHtml": false,
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": true,
                    "progressBar": false,
                    "positionClass": "toast-top-right",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "3000",
                    "hideDuration": "1000",
                    "timeOut": "0",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                };
                let json = JSON.parse(data);
                toastr["info"](json.message, json.title);
            });

            connection.on("RefreshDatatable", function (id) {
                if($(`#${id}`).length > 0){
                    console.log(`RefreshDatatable【${id}】`);
                    //目前頁面的頁碼
                    const page = $(`#${id}`).DataTable().page.info().page;
                    //刷新資料
                    $(`#${id}`).DataTable().page(page).draw(false);
                }
            });

            // Start the connection.
            start();
        });
    </script>
</body>

</html>